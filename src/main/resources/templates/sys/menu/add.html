<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
	<head>
		<th:block th:insert="~{include :: header('新增菜单')}"/>
	</head>
	<body class="white-bg">
		<div class="wrapper wrapper-content animated fadeInRight ibox-content">
			<form class="form-horizontal m" id="form-menu-add">
				<input id="treeId" name="parentId" th:value="${menu.menuId}" type="hidden"/>
				<div class="form-group">
					<label class="col-sm-3 control-label">上级菜单：</label>
					<div class="col-sm-8">
						<div class="input-group">
							<input class="form-control" id="treeName" name="parentName" onclick="selectMenuTree()"
								   readonly="true" th:value="${menu.menuName}" type="text">
							<span class="input-group-addon"><i class="fa fa-search"></i></span>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label is-required">菜单类型：</label>
					<div class="col-sm-8">
						<label class="radio-box"> <input name="menuType" type="radio" value="M"/> 目录 </label>
						<label class="radio-box"> <input name="menuType" type="radio" value="C"/> 菜单 </label>
						<label class="radio-box"> <input name="menuType" type="radio" value="F"/> 按钮 </label>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label is-required">菜单名称：</label>
					<div class="col-sm-8">
						<input class="form-control" id="menuName" name="menuName" required type="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label is-required">国际化：</label>
					<div class="col-sm-8">
						<input class="form-control" id="i18n" name="i18n" required type="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label"
						   title="访问的请求地址，如：`/system/user`，如外网地址需内链访问则以`http(s)://`开头">请求地址：<i
							class="fa fa-question-circle-o"></i></label>
					<div class="col-sm-8">
						<input class="form-control" id="url" name="url" type="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">打开方式：</label>
					<div class="col-sm-8">
						<select class="form-control m-b" id="target" name="target">
							<option value="menuItem">页签</option>
							<option value="menuBlank">新窗口</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label is-required" title="数字越小越靠前">显示排序：<i
							class="fa fa-question-circle-o"></i></label>
					<div class="col-sm-8">
						<input class="form-control" name="orderNum" required type="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" title="单击选择需要使用的FontAwesome图标">图标：<i
							class="fa fa-question-circle-o"></i></label>
					<div class="col-sm-8">
						<input class="form-control" id="icon" name="icon" placeholder="选择图标" type="text">
						<div class="ms-parent" style="width: 100%;">
							<div class="icon-drop animated flipInX"
								 style="display: none;max-height:200px;overflow-y:auto">
								<div th:insert="~{sys/menu/icon}"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">SVG图标：</label>
					<div class="col-sm-8">
						<input class="form-control" id="svg" name="svg" type="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" title="选择隐藏则菜单将不会出现在侧边栏">菜单状态：<i
							class="fa fa-question-circle-o"></i></label>
					<div class="col-sm-3">
						<div class="radio-box">
							<input checked id="visible-Y" name="visible" type="radio" value="0">
							<label for="visible-Y">显示</label>
						</div>
						<div class="radio-box">
							<input id="visible-N" name="visible" type="radio" value="1">
							<label for="visible-N">隐藏</label>
						</div>
					</div>
					<label class="col-sm-2 control-label is-refresh" title="打开菜单选项卡是否刷新页面">是否刷新：<i
							class="fa fa-question-circle-o"></i></label>
					<div class="col-sm-3 is-refresh">
						<div class="radio-box">
							<input checked id="refresh-no" name="isRefresh" type="radio" value="1">
							<label for="refresh-no">否</label>
						</div>
						<div class="radio-box">
							<input id="refresh-yes" name="isRefresh" type="radio" value="0">
							<label for="refresh-yes">是</label>
						</div>
					</div>
				</div>
			</form>
		</div>
		<th:block th:insert="~{include :: footer}"/>
		<script>
			var prefix = ctx + "sys/menu";

			$("#form-menu-add").validate({
				onkeyup: false,
				rules: {
					menuType: {
						required: true,
					},
					menuName: {
						remote: {
							url: prefix + "/checkMenuNameUnique",
							type: "post",
							dataType: "json",
							data: {
								"parentId": function () {
									return $("input[name='parentId']").val();
								},
								"menuName": function () {
									return $.common.trim($("#menuName").val());
								}
							}
						}
					},
					orderNum: {
						digits: true
					},
				},
				messages: {
					"menuName": {
						remote: "菜单已经存在"
					}
				},
				focusCleanup: true
			});

			function submitHandler() {
				if ($.validate.form()) {
					$.operate.save(prefix + "/add", $('#form-menu-add').serialize());
				}
			}

			$(function () {
				$("input[name='icon']").focus(function () {
					$(".icon-drop").show();
				});
				$("#form-menu-add").click(function (event) {
					var obj = event.srcElement || event.target;
					if (!$(obj).is("input[name='icon']")) {
						$(".icon-drop").hide();
					}
				});
				$(".icon-drop").find(".ico-list i").on("click", function () {
					$('#icon').val($(this).attr('class'));
				});
				$('input').on('ifChecked', function (event) {
					var menuType = $(event.target).val();
					if (menuType === "M") {
						$("#url").parents(".form-group").hide();
						$("#icon").parents(".form-group").show();
						$("#target").parents(".form-group").hide();
						$("input[name='visible']").parents(".form-group").show();
						$(".is-refresh").hide();
					} else if (menuType === "C") {
						$("#url").parents(".form-group").show();
						$("#icon").parents(".form-group").show();
						$("#target").parents(".form-group").show();
						$("input[name='visible']").parents(".form-group").show();
						$(".is-refresh").show();
					} else if (menuType === "F") {
						$("#url").parents(".form-group").hide();
						$("#icon").parents(".form-group").hide();
						$("#target").parents(".form-group").hide();
						$("input[name='visible']").parents(".form-group").hide();
						$(".is-refresh").hide();
					}
				});
			});

			/*菜单管理-新增-选择菜单树*/
			function selectMenuTree() {
				var treeId = $("#treeId").val();
				var menuId = treeId > 0 ? treeId : 1;
				var url = prefix + "/selectMenuTree/" + menuId;
				var options = {
					title: '菜单选择',
					width: "380",
					url: url,
					callBack: doSubmit
				};
				$.modal.openOptions(options);
			}

			function doSubmit(index, layero) {
				var body = $.modal.getChildFrame(index);
				$("#treeId").val(body.find('#treeId').val());
				$("#treeName").val(body.find('#treeName').val());
				$.modal.close(index);
			}
		</script>
	</body>
</html>
